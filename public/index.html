<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Questionnaire candidat - BabyChou Services</title>
    <!-- PWA meta tags -->
    <meta name="theme-color" content="#2E86AB" />
    <meta
      name="description"
      content="Questionnaire candidat - BabyChou Services"
    />
    <!-- styles -->
    <link rel="stylesheet" href="styles/main.css" />
    <link rel="stylesheet" href="styles/questionnaire.css" />
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json" />
  </head>
  <body>
    <div class="container">
      <header class="header">
        <div class="logo-container">
          <h1 class="logo-text">Babychou Services</h1>
          <p class="logo-subtitle">Questionnaire de candidature</p>
        </div>
      </header>
      <main class="main-content">
        <!-- Section d'accueil -->
        <section class="page-section" id="page-accueil">
          <div class="welcome-card">
            <h2 class="welcome-title">Bienvenue !</h2>
            <p class="welcome-text">
              Merci de votre int√©r√™t pour rejoindre l'√©quipe Babychou Services.
              Ce questionnaire nous permettra de mieux vous conna√Ætre.
            </p>

            <!-- Zone de messages -->
            <div class="message-container" id="message-container"></div>

            <form class="candidat-form" id="form-candidat">
              <div class="form-group">
                <label for="nom">Nom et Pr√©nom *</label>
                <input
                  type="text"
                  id="nom"
                  name="nom"
                  placeholder="Ex: Dupont Marie"
                />
                <div class="error-message" id="error-nom"></div>
              </div>
              <div class="form-group">
                <label for="email">Email *</label>
                <input type="text" id="email" name="email" />
                <div class="error-message" id="error-email"></div>
              </div>
              <div class="form-group">
                <label for="telephone">T√©l√©phone</label>
                <input type="tel" id="telephone" name="telephone" />
                <div class="error-message" id="error-telephone"></div>
              </div>
              <button type="submit" class="btn-commencer">
                Commencer le questionnaire
              </button>
            </form>
          </div>
        </section>

        <!-- Section questionnaire (cach√©e) -->
        <section class="page-section hidden" id="page-questionnaire">
          <div class="question-card">
            <div class="question-header">
              <h2 id="question-titre">Question 1 sur 5</h2>
              <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
              </div>
            </div>

            <div class="question-content" id="question-content">
              <!-- Les questions seront inject√©es ici par JavaScript -->
            </div>

            <div class="question-navigation">
              <button
                type="button"
                class="btn-secondary"
                id="btn-precedent"
                style="display: none"
              >
                Pr√©c√©dent
              </button>
              <button type="button" class="btn-primary" id="btn-suivant">
                Suivant
              </button>
            </div>
          </div>
        </section>

        <!-- Section r√©capitulatif (cach√©e) -->
        <section class="page-section hidden" id="page-recapitulatif">
          <div class="recap-card">
            <h2>R√©capitulatif de vos r√©ponses</h2>
            <div id="recap-content">
              <!-- R√©capitulatif g√©n√©r√© par JavaScript -->
            </div>
            <div class="recap-actions">
              <button type="button" class="btn-secondary" id="btn-modifier">
                Modifier mes r√©ponses
              </button>
              <button type="button" class="btn-primary" id="btn-envoyer">
                Envoyer le questionnaire
              </button>
            </div>
          </div>
        </section>
      </main>
      <footer class="footer">
        <p>&copy; 2025 Babychou Services - Valenciennes</p>
        <p>163 rue de Famars, 59300 Valenciennes</p>
        <p>Contact : Maxence FENEZ - 09 73 89 42 27</p>
      </footer>
    </div>

    <!-- JavaScript externe -->
    <script src="scripts/app.js"></script>
    <script src="scripts/questionnaire.js"></script>
    <script src="scripts/pwa.js"></script>

    <!-- Solution de contournement -->
    <script>
      console.log("üö® SOLUTION DE CONTOURNEMENT ACTIV√âE");

      // Attendre que tout soit charg√©
      setTimeout(() => {
        console.log("üîß For√ßage de l'initialisation des boutons...");

        const btnSuivant = document.getElementById("btn-suivant");
        const btnPrecedent = document.getElementById("btn-precedent");

        if (btnSuivant) {
          // Supprimer tous les listeners existants
          const nouveauBtnSuivant = btnSuivant.cloneNode(true);
          btnSuivant.parentNode.replaceChild(nouveauBtnSuivant, btnSuivant);

          // Ajouter notre propre listener
          document
            .getElementById("btn-suivant")
            .addEventListener("click", function () {
              console.log("üéØ BOUTON SUIVANT CLIQU√â (contournement)!");

              // Logique simple
              if (typeof window.questionActuelle !== "undefined") {
                // Sauvegarder la r√©ponse actuelle
                const questionActuelle = window.questionActuelle;
                const question = window.questionsRH[questionActuelle];

                if (question.type === "radio") {
                  const selected = document.querySelector(
                    `input[name="question_${question.id}"]:checked`
                  );
                  if (selected) {
                    window.reponses[question.id] = selected.value;
                    console.log("üíæ R√©ponse sauv√©e:", selected.value);
                  }
                }

                // Passer √† la question suivante
                if (window.questionActuelle < window.questionsRH.length - 1) {
                  window.questionActuelle++;
                  console.log(
                    "‚û°Ô∏è Question suivante:",
                    window.questionActuelle + 1
                  );

                  if (typeof window.afficherQuestion === "function") {
                    window.afficherQuestion(window.questionActuelle);
                  } else {
                    console.error("‚ùå afficherQuestion non disponible");
                  }
                } else {
                  console.log("‚úÖ Questionnaire termin√©!");
                  if (typeof window.afficherRecapitulatif === "function") {
                    window.afficherRecapitulatif();
                  } else {
                    alert("Questionnaire termin√©!");
                  }
                }
              } else {
                console.error("‚ùå Variables globales non disponibles");
              }
            });

          console.log("‚úÖ Event listener de contournement ajout√©!");
        } else {
          console.error("‚ùå Bouton Suivant introuvable!");
        }

        // M√™me chose pour le bouton pr√©c√©dent
        if (btnPrecedent) {
          const nouveauBtnPrecedent = btnPrecedent.cloneNode(true);
          btnPrecedent.parentNode.replaceChild(
            nouveauBtnPrecedent,
            btnPrecedent
          );

          document
            .getElementById("btn-precedent")
            .addEventListener("click", function () {
              console.log("üéØ BOUTON PR√âC√âDENT CLIQU√â (contournement)!");

              if (window.questionActuelle > 0) {
                window.questionActuelle--;
                console.log(
                  "‚¨ÖÔ∏è Question pr√©c√©dente:",
                  window.questionActuelle + 1
                );

                if (typeof window.afficherQuestion === "function") {
                  window.afficherQuestion(window.questionActuelle);
                }
              }
            });
        }
      }, 2000); // Attendre 2 secondes
    </script>
  </body>
</html>
